SSL Switcher

[機能]
MODxでhttpsのページを少しだけ扱いやすくするプラグインです。
現在、以下の機能があります。

1.[~s(ドキュメントID)~]によるURL変換
  MODxのコンテンツに[~(ドキュメントID)~]と表記するとドキュメントIDのURLを表示してくれます。
  SSL Swicherでは新たに[~s(ドキュメントID)~]表記が使用できます。
  ※「s」がついてます。

  [~s(ドキュメントID)~]を使った場合も、指定したドキュメントIDのURLを表示してくれるのですが、
  httpsのページに指定しているドキュメントに関してはhttps+ドメイン付のフルパスURLで表示します。
  ドメイン付のURLに変換してくれるルールは少し複雑で以下のとおりです。

                                  ※[~s(DocID)~]を書くドキュメント
                                | httpなページ  | httpsなページ
  ----------------------------------------------------------------------------------
  ※DocIDの指定ドキュメント     |               |
                  httpなページ  |通常変換       |http+ドメイン付URL表示
                  httpsなページ |http+ドメイン付|通常変換


2.httpからhttpsのページの強制リダイレクト
ドキュメント内の「SwitchHTTP to HTTPS」有効にすると、そのドキュメントにhttpでアクセスしてきた場合、
強制的にhttpsのページにリダイレクトさせます。


[動作確認環境]
  ・MODx0.9.5 and 0.9.6
  ・PHP5.2.x
  ・MySQL 5.0.33
  ・文字コード UTF-8

[インストール方法]
1.アーカイブファイルを解凍します。

2.管理画面でプラグインを新規作成します。
  ※「リソース」→「リソース管理」→「プラグイン」→「プラグインの作成」

    [全般]
    プラグイン名    : sslSwitcher
    説明            : (任意)
    プラグインコード: sslSwitcher.txtファイルの中身をそのまま張りつける

    [設定]※特に設定はありません    

    [システムイベント]
    次のイベントをクリックしてチェックを付けてください。

      ・OnWebPageInit
      ・OnWebPagePrerender

3.管理画面でテンプレート変数を作成します。
  ※「リソース」→「リソース管理」→「テンプレート変数」
                                         →「テンプレート変数の作成」

    変数名               : sslSwitcher
    説明                 : (任意)
    入力タイプ           : Check Box
    入力時のオプション値 : UseHTTPS||SwitchHTTP to HTTPS
    規定値               : 空白のまま
    Widget               : 選択無
    並べ替え順           : (任意)※わからなければ0でOKです
    テンプレートへのアクセス： 
                    現在使用しているテンプレートをチェックしてください。
                    (よくわかれなければ全てにチェックでもOKです)

[使い方]
1.管理画面でhttpsを使いたいドキュメントを編集します。
  テンプレート変数の部分に「UseHTTPS」「SwitchHTTP to HTTPS」と書かれたチェ
  ックボックスが表示されているので、必要に応じてチェックをつけて保存します。
  
    ・UseHTTPS
      該当ドキュメントではhttpsを使用する

    ・SwitchHTTP to HTTPS
      httpでアクセスされた場合、強制的にhttpsページに切り替える

2.ドキュメント内で[~(ドキュメントID)~]と書く部分を以下のように書き換えます。

    [~s(ドキュメントID)~]    ※「s」がついてます。

  これで通常は[~(ドキュメントID)~]と同じような変換を行うのですが、httpから
  httpsのドキュメントに移るような場合はhttps付のURLにかわります。
  (httpsからhttpに移るときはhttp付のURLにかわります)

3.httpからhttpsページの切り替え
  「SwitchHTTP to HTTPS」を有効にしているドキュメントにhttpでアクセスします。
  するとhttpsのページに切り替わります。

[URL変換の例]
  [サイトのURL] http://ayd.jp/
  [httpのドキュメントID] 10
  [httpsのドキュメントID] 20

1.ドキュメントID10で以下の書き方をした場合の変換後のURL

    [~s10~] → /index.php?q=10
    [~s20~] → https://ayd.jp/index.php?q=20

2.ドキュメントID20で以下の書き方をした場合の変換後のURL

    [~s10~] → http://ayd.jp/index.php?q=10
    [~s20~] → /index.php?q=20


[更新履歴]
 2007/12/12 - 1.01
  ・http→httpsリダイレクト機能を追加
  ・readmeを修正
 2007/12/10 - 1.00
  ・リリース

